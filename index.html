<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€ç»´è·³æ£‹æ¸¸æˆ@å­™ç»´åˆšç ”ç©¶é™¢</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 20px;
            margin: 10px;
            max-width: 900px;
            width: calc(100% - 20px);
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .rules {
            background: #f7fafc;
            border-left: 5px solid #4299e1;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 0 10px 10px 0;
        }

        .rules h3 {
            margin-top: 0;
            color: #2d3748;
        }

        .rules ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .rules li {
            margin: 8px 0;
            line-height: 1.6;
        }

        .game-board {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 25px 10px 15px 10px;
            background: #edf2f7;
            border-radius: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            overflow-x: auto;
            flex-wrap: nowrap;
        }

        .cell {
            width: 45px;
            height: 45px;
            border: 2px solid #2d3748;
            margin: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            touch-action: manipulation;
            min-width: 44px;
            min-height: 44px;
        }

        .cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .cell.empty {
            background: #f56565;
            border-color: #e53e3e;
        }

        .cell.selected {
            background: #68d391;
            border-color: #38a169;
            transform: scale(1.1);
        }

        .cell.valid-move {
            background: #fbb6ce;
            border-color: #d69e2e;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .piece {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4299e1, #2b6cb0);
            border: 2px solid #2a4365;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .piece:hover {
            transform: scale(1.1);
        }

        .controls {
            text-align: center;
            margin: 30px 0;
        }

        button {
            background: linear-gradient(135deg, #4299e1, #2b6cb0);
            color: white;
            border: none;
            padding: 14px 20px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            touch-action: manipulation;
            min-width: 44px;
            min-height: 44px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: #e6fffa;
            border: 2px solid #38b2ac;
        }

        .status.setup {
            background: #fff5f5;
            border-color: #f56565;
        }

        .status.game-over {
            background: #f0fff4;
            border-color: #38a169;
        }

        .cell-number {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #718096;
            font-weight: bold;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 4px;
            border-radius: 4px;
            min-width: 16px;
            text-align: center;
        }

        .piece-count {
            text-align: center;
            font-size: 16px;
            color: #4a5568;
            margin: 10px 0;
        }

        .move-hint {
            text-align: center;
            color: #718096;
            font-style: italic;
            margin: 10px 0;
        }

        .game-phase {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #2d3748;
            margin: 20px 0;
            padding: 10px;
            background: #edf2f7;
            border-radius: 10px;
        }

        .reverse-mode {
            background: #fef5e7 !important;
            border-color: #d69e2e !important;
        }

        .reverse-mode .cell.empty {
            background: #ffffff !important;
            border-color: #2d3748 !important;
        }

        .cell.reverse-target {
            background: #fed7d7;
            border-color: #e53e3e;
            animation: pulse 1s infinite;
        }

        .cell.reverse-source {
            background: #c6f6d5;
            border-color: #38a169;
        }

        .reverse-ghost-piece {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(160, 174, 192, 0.6);
            border: 2px solid rgba(160, 174, 192, 0.8);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        /* é€†æ¨æ¨¡å¼ä¸‹çš„æ­£æ–¹å½¢æ ·å¼ */
        .reverse-mode .game-board {
            justify-content: flex-start;
            overflow-x: auto;
            padding: 25px 15px 15px 15px;
        }

        .reverse-mode .cell {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            margin: 0 1px;
            flex-shrink: 0;
        }

        .reverse-mode .piece {
            width: 28px;
            height: 28px;
        }

        .reverse-mode .reverse-ghost-piece {
            width: 28px;
            height: 28px;
        }

        /* è¢«è·³è¿‡çš„æ£‹å­æ ·å¼ - æ·»åŠ å‰å· */
        .jumped-piece::after {
            content: 'âœ•';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #e53e3e;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
            z-index: 10;
        }

        /* å·¦ä¾§å¯è¡Œä½ç½® */
        .reverse-target-left {
            background: #fed7d7;
            border-color: #f56565;
            animation: pulse 1s infinite;
        }

        /* å³ä¾§å¯è¡Œä½ç½® */
        .reverse-target-right {
            background: #bee3f8;
            border-color: #4299e1;
            animation: pulse 1s infinite;
        }

        .reverse-ghost-piece-left {
            background: rgba(245, 101, 101, 0.6);
            border: 2px solid rgba(245, 101, 101, 0.8);
        }

        .reverse-ghost-piece-right {
            background: rgba(66, 153, 225, 0.6);
            border: 2px solid rgba(66, 153, 225, 0.8);
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .game-container {
                padding: 15px;
                margin: 5px;
                border-radius: 15px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }

            .game-board {
                margin: 15px 0;
                padding: 20px 5px 10px 5px;
                overflow-x: auto;
                justify-content: flex-start;
            }

            .cell {
                width: 35px;
                height: 35px;
                margin: 1px;
                border-width: 2px;
                min-width: 35px;
                min-height: 35px;
            }

            .piece {
                width: 22px;
                height: 22px;
            }

            .reverse-ghost-piece {
                width: 22px;
                height: 22px;
            }

            /* é€†æ¨æ¨¡å¼ä¸‹çš„æ­£æ–¹å½¢æ ·å¼è°ƒæ•´ */
            .reverse-mode .game-board {
                padding: 20px 5px 10px 5px;
                justify-content: flex-start;
                overflow-x: auto;
            }

            .reverse-mode .cell {
                width: 35px;
                height: 35px;
                min-width: 35px;
                min-height: 35px;
                margin: 0 1px;
                flex-shrink: 0;
            }

            .reverse-mode .piece {
                width: 22px;
                height: 22px;
            }

            .reverse-mode .reverse-ghost-piece {
                width: 22px;
                height: 22px;
            }

            .controls {
                margin: 20px 0;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
            }

            button {
                font-size: 14px;
                padding: 12px 16px;
                margin: 0;
                flex: 1;
                min-width: 120px;
                max-width: 150px;
            }

            .status, .move-hint, .piece-count {
                font-size: 14px;
                padding: 10px;
                margin: 8px 0;
            }

            .game-phase {
                font-size: 16px;
                padding: 8px;
                margin: 15px 0;
            }

            .rules {
                margin-top: 20px;
                padding: 15px;
            }

            .rules h3 {
                font-size: 16px;
            }

            .rules li {
                font-size: 14px;
                margin: 6px 0;
            }

            .cell-number {
                font-size: 10px;
                top: -16px;
                padding: 1px 3px;
            }

            .jumped-piece::after {
                font-size: 18px;
            }
        }

        /* è¶…å°å±å¹•é€‚é… */
        @media (max-width: 480px) {
            .game-board {
                padding: 20px 2px 10px 2px;
                margin: 10px 0;
            }
            .cell {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
                margin: 0.5px;
            }

            .piece {
                width: 18px;
                height: 18px;
            }

            .reverse-ghost-piece {
                width: 18px;
                height: 18px;
            }

            .reverse-mode .cell {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
                margin: 0 0.5px;
                flex-shrink: 0;
            }

            .reverse-mode .piece,
            .reverse-mode .reverse-ghost-piece {
                width: 18px;
                height: 18px;
            }

            button {
                font-size: 12px;
                padding: 10px 12px;
                min-width: 100px;
            }

            .jumped-piece::after {
                font-size: 14px;
            }

            .cell-number {
                font-size: 8px;
                top: -14px;
                padding: 1px 2px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ä¸€ç»´è·³æ£‹æ¸¸æˆ @ å­™ç»´åˆšç ”ç©¶é™¢</h1>

        <div class="game-phase" id="gamePhase">é˜¶æ®µä¸€ï¼šé€‰æ‹©åˆå§‹ç©ºæ ¼ä½ç½®</div>

        <div class="game-board" id="gameBoard">
            <!-- æ£‹ç›˜æ ¼å­å°†ç”±JavaScriptç”Ÿæˆ -->
        </div>

        <div class="piece-count" id="pieceCount">æ£‹å­æ•°é‡ï¼š10</div>
        <div class="status" id="status">è¯·ç‚¹å‡»ä»»æ„æ£‹å­ç§»é™¤ï¼Œåˆ›å»ºåˆå§‹ç©ºæ ¼å¼€å§‹æ¸¸æˆ</div>
        <div class="move-hint" id="moveHint"></div>

        <div class="controls">
            <button onclick="resetGame()" id="resetBtn">é‡æ–°å¼€å§‹</button>
            <button onclick="undoMove()" id="undoBtn">æ’¤å›ä¸Šä¸€æ­¥</button>
            <button onclick="toggleMode()" id="modeBtn">åˆ‡æ¢åˆ°é€†æ¨æ¨¡å¼</button>
        </div>
        
        <div class="rules">
            <h3>æ¸¸æˆè§„åˆ™ï¼š</h3>
            <ul>
                <li><strong>ç›®æ ‡ï¼š</strong>é€šè¿‡è·³æ£‹æ“ä½œï¼Œä½¿æ£‹ç›˜ä¸Šæœ€ç»ˆåªå‰©ä¸‹ä¸€æšæ£‹å­</li>
                <li><strong>è·³æ£‹è§„åˆ™ï¼š</strong>è‹¥æ£‹å­Aå’ŒBç›¸é‚»ï¼Œä¸”Bå¦ä¸€ä¾§æ˜¯ç©ºæ ¼ï¼Œåˆ™æ£‹å­Aå¯ç»•è¿‡Bè·³åˆ°ç©ºæ ¼ä¸­ï¼Œå¹¶åƒæ‰æ£‹å­B</li>
                <li><strong>åˆå§‹è®¾ç½®ï¼š</strong>ç‚¹å‡»ä»»æ„æ£‹å­å°†å…¶ç§»é™¤ï¼Œåˆ›å»ºåˆå§‹ç©ºæ ¼</li>
                <li><strong>æ“ä½œæ–¹æ³•ï¼š</strong>ç‚¹å‡»è¦ç§»åŠ¨çš„æ£‹å­ï¼Œå†ç‚¹å‡»ç›®æ ‡ç©ºæ ¼ï¼ˆå¿…é¡»ç¬¦åˆè·³æ£‹è§„åˆ™ï¼‰</li>
            </ul>
        </div>
    </div>

    <script>
        class OneDChess {
            constructor() {
                this.isReverseMode = false; // éœ€è¦å…ˆè®¾ç½®è¿™ä¸ª
                this.boardSize = 10; // é»˜è®¤æ­£å‘æ¨¡å¼10ä¸ªæ ¼å­
                this.board = Array(this.boardSize).fill(true); // trueè¡¨ç¤ºæœ‰æ£‹å­ï¼Œfalseè¡¨ç¤ºç©ºæ ¼
                this.gameStarted = false;
                this.selectedPiece = -1;
                this.moveCount = 0;
                this.emptyPosition = -1;
                this.moveHistory = []; // å­˜å‚¨ç§»åŠ¨å†å²
                this.reverseHistory = []; // å­˜å‚¨é€†æ¨å†å²
                this.reverseStep = 0; // é€†æ¨æ­¥æ•°
                this.reverseSetup = false; // é€†æ¨æ¨¡å¼è®¾ç½®é˜¶æ®µ
                this.init();
            }

            init() {
                this.createBoard();
                this.updateDisplay();
            }

            createBoard() {
                const boardElement = document.getElementById('gameBoard');
                boardElement.innerHTML = '';
                
                for (let i = 0; i < this.boardSize; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.position = i;
                    
                    const cellNumber = document.createElement('div');
                    cellNumber.className = 'cell-number';
                    cellNumber.textContent = i + 1;
                    cell.appendChild(cellNumber);
                    
                    cell.addEventListener('click', () => this.handleCellClick(i));
                    boardElement.appendChild(cell);
                }
            }

            handleCellClick(position) {
                if (this.isReverseMode) {
                    this.handleReverseModeClick(position);
                    return;
                }

                if (!this.gameStarted) {
                    // åˆå§‹é˜¶æ®µï¼šç§»é™¤æ£‹å­åˆ›å»ºç©ºæ ¼
                    if (this.board[position]) {
                        this.board[position] = false;
                        this.emptyPosition = position;
                        this.gameStarted = true;
                        this.updateDisplay();
                        this.updateStatus(`æ¸¸æˆå¼€å§‹ï¼ç©ºæ ¼ä½ç½®ï¼š${position + 1}ã€‚è¯·é€‰æ‹©è¦ç§»åŠ¨çš„æ£‹å­ã€‚`);
                        this.updateGamePhase("é˜¶æ®µäºŒï¼šè·³æ£‹æ¸¸æˆè¿›è¡Œä¸­");
                        // æ’¤å›æŒ‰é’®å§‹ç»ˆæ˜¾ç¤ºï¼Œä¸éœ€è¦æ§åˆ¶æ˜¾ç¤º/éšè—
                    }
                } else {
                    // æ¸¸æˆé˜¶æ®µ
                    if (this.board[position] && this.selectedPiece === -1) {
                        // é€‰æ‹©æ£‹å­
                        this.selectedPiece = position;
                        this.updateDisplay();
                        this.showValidMoves();
                        this.updateMoveHint(`å·²é€‰æ‹©ä½ç½® ${position + 1} çš„æ£‹å­ï¼Œè¯·ç‚¹å‡»å¯è·³è·ƒçš„ç›®æ ‡ä½ç½®`);
                    } else if (this.selectedPiece !== -1 && !this.board[position]) {
                        // å°è¯•ç§»åŠ¨åˆ°ç©ºæ ¼
                        if (this.isValidMove(this.selectedPiece, position)) {
                            this.makeMove(this.selectedPiece, position);
                            this.selectedPiece = -1;
                            this.moveCount++;
                            this.updateDisplay();
                            this.checkGameEnd();
                        } else {
                            this.updateMoveHint("æ— æ•ˆç§»åŠ¨ï¼è¯·é€‰æ‹©ç¬¦åˆè·³æ£‹è§„åˆ™çš„ä½ç½®");
                        }
                    } else if (this.board[position] && this.selectedPiece !== -1) {
                        // é‡æ–°é€‰æ‹©æ£‹å­
                        this.selectedPiece = position;
                        this.updateDisplay();
                        this.showValidMoves();
                        this.updateMoveHint(`é‡æ–°é€‰æ‹©ä½ç½® ${position + 1} çš„æ£‹å­`);
                    }
                }
            }

            isValidMove(from, to) {
                // æ£€æŸ¥æ˜¯å¦ç¬¦åˆè·³æ£‹è§„åˆ™
                const distance = Math.abs(to - from);
                if (distance !== 2) return false;
                
                const middle = from + (to - from) / 2;
                return this.board[middle] && !this.board[to];
            }

            makeMove(from, to) {
                const middle = from + (to - from) / 2;
                
                // ä¿å­˜ç§»åŠ¨å†å²ï¼ˆç”¨äºæ’¤å›ï¼‰
                this.moveHistory.push({
                    from: from,
                    to: to,
                    middle: middle,
                    boardState: [...this.board]
                });
                
                this.board[from] = false;
                this.board[middle] = false; // åƒæ‰ä¸­é—´çš„æ£‹å­
                this.board[to] = true;
            }

            showValidMoves() {
                if (this.selectedPiece === -1) return;
                
                const cells = document.querySelectorAll('.cell');
                cells.forEach(cell => cell.classList.remove('valid-move'));
                
                for (let i = 0; i < this.boardSize; i++) {
                    if (this.isValidMove(this.selectedPiece, i)) {
                        cells[i].classList.add('valid-move');
                    }
                }
            }

            updateDisplay() {
                const cells = document.querySelectorAll('.cell');
                const gameBoard = document.getElementById('gameBoard');
                let pieceCount = 0;
                
                // ä¸ºæ£‹ç›˜å®¹å™¨æ·»åŠ æˆ–ç§»é™¤é€†æ¨æ¨¡å¼ç±»
                if (this.isReverseMode) {
                    gameBoard.classList.add('reverse-mode');
                    // é€†æ¨æ¨¡å¼ä¸‹æ»šåŠ¨åˆ°ä¸­å¿ƒä½ç½®ï¼ˆç¬¬10ä¸ªæ ¼å­ï¼‰
                    setTimeout(() => {
                        this.scrollToCenter();
                    }, 100);
                } else {
                    gameBoard.classList.remove('reverse-mode');
                }
                
                cells.forEach((cell, index) => {
                    cell.innerHTML = '';
                    
                    // æ·»åŠ ä½ç½®ç¼–å·
                    const cellNumber = document.createElement('div');
                    cellNumber.className = 'cell-number';
                    cellNumber.textContent = index + 1;
                    cell.appendChild(cellNumber);
                    
                    // é‡ç½®æ ·å¼ï¼Œä¿ç•™åŸºæœ¬cellç±»
                    cell.className = 'cell';
                    
                    if (this.board[index]) {
                        const piece = document.createElement('div');
                        piece.className = 'piece';
                        cell.appendChild(piece);
                        pieceCount++;
                        
                        if (index === this.selectedPiece) {
                            cell.classList.add('selected');
                        }
                    } else {
                        cell.classList.add('empty');
                    }
                });
                
                document.getElementById('pieceCount').textContent = `æ£‹å­æ•°é‡ï¼š${pieceCount}`;
                
                if (this.isReverseMode && this.selectedPiece !== -1) {
                    this.showReverseOptions();
                } else if (!this.isReverseMode && this.selectedPiece !== -1) {
                    this.showValidMoves();
                }
            }

            checkGameEnd() {
                const pieceCount = this.board.filter(cell => cell).length;
                const hasValidMoves = this.hasAnyValidMove();
                
                if (pieceCount === 1) {
                    this.updateStatus(`ğŸ‰ æ­å–œï¼æ‚¨æˆåŠŸäº†ï¼æœ€ç»ˆå‰©ä½™1æšæ£‹å­ã€‚åˆå§‹ç©ºæ ¼ä½ç½®ï¼š${this.emptyPosition + 1}`);
                    this.updateGamePhase("æ¸¸æˆå®Œæˆï¼");
                    this.updateMoveHint("");
                } else if (!hasValidMoves) {
                    this.updateStatus(`ğŸ˜ æ¸¸æˆç»“æŸï¼æ— æ³•ç»§ç»­ç§»åŠ¨ã€‚å‰©ä½™${pieceCount}æšæ£‹å­ã€‚åˆå§‹ç©ºæ ¼ä½ç½®ï¼š${this.emptyPosition + 1}`);
                    this.updateGamePhase("æ¸¸æˆç»“æŸ");
                    this.updateMoveHint("å°è¯•ä¸åŒçš„åˆå§‹ç©ºæ ¼ä½ç½®å§ï¼");
                } else {
                    this.updateStatus(`ç»§ç»­æ¸¸æˆï¼è¿˜æœ‰ ${pieceCount} æšæ£‹å­ï¼Œå·²ç§»åŠ¨ ${this.moveCount} æ­¥`);
                    this.updateMoveHint("é€‰æ‹©ä¸€æšæ£‹å­è¿›è¡Œè·³è·ƒ");
                }
            }

            hasAnyValidMove() {
                for (let i = 0; i < this.boardSize; i++) {
                    if (this.board[i]) {
                        for (let j = 0; j < this.boardSize; j++) {
                            if (this.isValidMove(i, j)) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }

            updateStatus(message) {
                const statusElement = document.getElementById('status');
                statusElement.textContent = message;
                
                if (!this.gameStarted) {
                    statusElement.className = 'status setup';
                } else if (this.board.filter(cell => cell).length === 1 || !this.hasAnyValidMove()) {
                    statusElement.className = 'status game-over';
                } else {
                    statusElement.className = 'status';
                }
            }

            updateGamePhase(phase) {
                document.getElementById('gamePhase').textContent = phase;
            }

            updateMoveHint(hint) {
                document.getElementById('moveHint').textContent = hint;
            }

            scrollToCenter() {
                if (!this.isReverseMode) return;
                
                const gameBoard = document.getElementById('gameBoard');
                const cells = document.querySelectorAll('.cell');
                
                if (cells.length >= 10) {
                    // è®¡ç®—ç¬¬10ä¸ªæ ¼å­çš„ä½ç½®ï¼ˆç´¢å¼•ä¸º9ï¼‰
                    const targetCell = cells[9];
                    const cellRect = targetCell.getBoundingClientRect();
                    const boardRect = gameBoard.getBoundingClientRect();
                    
                    // è®¡ç®—éœ€è¦æ»šåŠ¨çš„è·ç¦»ï¼Œä½¿ç¬¬10ä¸ªæ ¼å­å±…ä¸­
                    const scrollLeft = targetCell.offsetLeft - (gameBoard.clientWidth / 2) + (targetCell.offsetWidth / 2);
                    
                    gameBoard.scrollTo({
                        left: Math.max(0, scrollLeft),
                        behavior: 'smooth'
                    });
                }
            }

            handleReverseModeClick(position) {
                if (this.reverseSetup) {
                    // é€†æ¨æ¨¡å¼è®¾ç½®é˜¶æ®µï¼šæ”¾ç½®æ£‹å­
                    if (!this.board[position]) {
                        this.board[position] = true;
                        this.updateDisplay();
                        const pieceCount = this.board.filter(cell => cell).length;
                        // æ”¾ç½®ç¬¬ä¸€ä¸ªæ£‹å­åè‡ªåŠ¨å¼€å§‹é€†æ¨
                        if (pieceCount === 1) {
                            this.reverseSetup = false;
                            this.updateGamePhase("é€†æ¨æ¨¡å¼ï¼šä»ç»“æœå¾€å›æ¨");
                            this.updateStatus("é€†æ¨æ¨¡å¼ï¼šç‚¹å‡»æ£‹å­æŸ¥çœ‹å¯èƒ½çš„ä¸Šä¸€æ­¥");
                            this.updateMoveHint("é€‰æ‹©æ£‹å­æŸ¥çœ‹é€†æ¨é€‰é¡¹");
                            document.getElementById('modeBtn').textContent = 'ç»“æŸé€†æ¨æ¨¡å¼';
                        } else {
                            this.updateStatus(`å·²æ”¾ç½® ${pieceCount} æšæ£‹å­ã€‚`);
                        }
                    } else {
                        // ç§»é™¤æ£‹å­
                        this.board[position] = false;
                        this.updateDisplay();
                        const pieceCount = this.board.filter(cell => cell).length;
                        this.updateStatus(`å·²ç§»é™¤æ£‹å­ï¼Œå½“å‰ ${pieceCount} æšæ£‹å­ã€‚`);
                    }
                    return;
                }

                if (this.board[position] && this.selectedPiece === -1) {
                    // é€‰æ‹©æ£‹å­æŸ¥çœ‹é€†æ¨é€‰é¡¹
                    this.selectedPiece = position;
                    this.updateDisplay();
                    this.updateMoveHint(`å·²é€‰æ‹©ä½ç½® ${position + 1} çš„æ£‹å­ï¼Œæ˜¾ç¤ºå¯èƒ½çš„é€†æ¨æ­¥éª¤`);
                } else if (!this.board[position] && this.selectedPiece !== -1) {
                    // ç‚¹å‡»ç©ºæ ¼æ‰§è¡Œé€†æ¨
                    if (this.isValidReverseMove(this.selectedPiece, position)) {
                        this.makeReverseMove(this.selectedPiece, position);
                        this.selectedPiece = -1;
                        this.reverseStep++;
                        this.updateDisplay();
                        this.updateStatus(`é€†æ¨ç¬¬ ${this.reverseStep} æ­¥ï¼šæ£‹å­æ•°é‡ ${this.board.filter(cell => cell).length}`);
                        this.updateMoveHint("ç»§ç»­é€‰æ‹©æ£‹å­è¿›è¡Œé€†æ¨ï¼Œæˆ–åˆ‡æ¢å›æ­£å‘æ¨¡å¼");
                    } else {
                        this.updateMoveHint("æ— æ•ˆçš„é€†æ¨ä½ç½®ï¼è¯·é€‰æ‹©ç¬¦åˆè§„åˆ™çš„ä½ç½®");
                    }
                } else if (this.board[position] && this.selectedPiece !== -1) {
                    // é‡æ–°é€‰æ‹©æ£‹å­
                    this.selectedPiece = position;
                    this.updateDisplay();
                    this.updateMoveHint(`é‡æ–°é€‰æ‹©ä½ç½® ${position + 1} çš„æ£‹å­`);
                } else {
                    this.selectedPiece = -1;
                    this.updateDisplay();
                    this.updateMoveHint("è¯·é€‰æ‹©ä¸€ä¸ªæ£‹å­æŸ¥çœ‹é€†æ¨é€‰é¡¹");
                }
            }

            isValidReverseMove(piecePosition, targetPosition) {
                // é€†æ¨çš„æœ‰æ•ˆç§»åŠ¨ï¼šç›®æ ‡ä½ç½®å¿…é¡»ä¸æ£‹å­è·ç¦»ä¸º2ï¼Œä¸”ä¸­é—´æ²¡æœ‰æ£‹å­
                const distance = Math.abs(targetPosition - piecePosition);
                if (distance !== 2) return false;
                
                const middle = piecePosition + (targetPosition - piecePosition) / 2;
                return !this.board[middle] && !this.board[targetPosition];
            }

            makeReverseMove(piecePosition, targetPosition) {
                // é€†æ¨ç§»åŠ¨ï¼šåœ¨ç›®æ ‡ä½ç½®å’Œä¸­é—´ä½ç½®æ”¾ç½®æ£‹å­ï¼Œç§»é™¤åŸæ¥çš„æ£‹å­
                const middle = piecePosition + (targetPosition - piecePosition) / 2;
                
                // ä¿å­˜é€†æ¨å†å²ï¼ˆç”¨äºæ’¤é”€ï¼‰
                this.reverseHistory.push({
                    piecePosition: piecePosition,
                    targetPosition: targetPosition,
                    middle: middle,
                    boardState: [...this.board]
                });
                
                this.board[piecePosition] = false;
                this.board[middle] = true;
                this.board[targetPosition] = true;
            }

            showReverseOptions() {
                if (this.selectedPiece === -1) return;
                
                const cells = document.querySelectorAll('.cell');
                cells.forEach(cell => {
                    cell.classList.remove('reverse-target', 'reverse-target-left', 'reverse-target-right', 'reverse-source', 'jumped-piece');
                    // ç§»é™¤ä¹‹å‰çš„ç°è‰²æ£‹å­
                    const ghostPieces = cell.querySelectorAll('.reverse-ghost-piece, .reverse-ghost-piece-left, .reverse-ghost-piece-right');
                    ghostPieces.forEach(ghost => ghost.remove());
                });
                
                // æ ‡è®°å½“å‰é€‰ä¸­çš„æ£‹å­
                cells[this.selectedPiece].classList.add('reverse-source');
                
                // æ˜¾ç¤ºå¯èƒ½çš„é€†æ¨ä½ç½®ï¼šåŒºåˆ†å·¦å³ä¸¤ä¾§
                for (let i = 0; i < this.boardSize; i++) {
                    if (this.isValidReverseMove(this.selectedPiece, i)) {
                        const middle = this.selectedPiece + (i - this.selectedPiece) / 2;
                        const isLeftMove = i < this.selectedPiece;
                        
                        // ä¸ºç›®æ ‡ä½ç½®å’Œä¸­é—´ä½ç½®æ·»åŠ ä¸åŒçš„æ ·å¼
                        if (isLeftMove) {
                            cells[i].classList.add('reverse-target-left');
                        } else {
                            cells[i].classList.add('reverse-target-right');
                        }
                        
                        // ä¸ºä¸­é—´ä½ç½®ï¼ˆè¢«è·³è¿‡çš„æ£‹å­ï¼‰æ·»åŠ å‰å·
                        cells[middle].classList.add('jumped-piece');
                        
                        // åœ¨ç›®æ ‡ä½ç½®æ˜¾ç¤ºç°è‰²æ£‹å­ï¼ˆè¡¨ç¤ºé€†æ¨åä¼šåœ¨è¿™é‡Œæ”¾æ£‹å­ï¼‰
                        const targetGhost = document.createElement('div');
                        targetGhost.className = isLeftMove ? 'reverse-ghost-piece reverse-ghost-piece-left' : 'reverse-ghost-piece reverse-ghost-piece-right';
                        cells[i].appendChild(targetGhost);
                        
                        // åœ¨ä¸­é—´ä½ç½®æ˜¾ç¤ºç°è‰²æ£‹å­ï¼ˆè¡¨ç¤ºé€†æ¨åä¼šæ¢å¤è¢«åƒæ‰çš„æ£‹å­ï¼‰
                        const middleGhost = document.createElement('div');
                        middleGhost.className = isLeftMove ? 'reverse-ghost-piece reverse-ghost-piece-left' : 'reverse-ghost-piece reverse-ghost-piece-right';
                        cells[middle].appendChild(middleGhost);
                    }
                }
            }

            reset() {
                this.isReverseMode = false;
                this.boardSize = 10;
                this.board = Array(this.boardSize).fill(true);
                this.gameStarted = false;
                this.selectedPiece = -1;
                this.moveCount = 0;
                this.emptyPosition = -1;
                this.moveHistory = [];
                this.reverseHistory = [];
                this.reverseStep = 0;
                this.reverseSetup = false;
                this.createBoard(); // é‡æ–°åˆ›å»º10æ ¼æ£‹ç›˜
                this.updateDisplay();
                this.updateStatus("è¯·ç‚¹å‡»ä»»æ„æ£‹å­ç§»é™¤ï¼Œåˆ›å»ºåˆå§‹ç©ºæ ¼å¼€å§‹æ¸¸æˆ");
                this.updateGamePhase("é˜¶æ®µä¸€ï¼šé€‰æ‹©åˆå§‹ç©ºæ ¼ä½ç½®");
                this.updateMoveHint("");
                // æ’¤å›æŒ‰é’®å§‹ç»ˆæ˜¾ç¤º
                document.getElementById('modeBtn').textContent = 'åˆ‡æ¢åˆ°é€†æ¨æ¨¡å¼';
            }
        }

        // å…¨å±€æ¸¸æˆå®ä¾‹
        let game;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            game = new OneDChess();
        });

        function resetGame() {
            game.reset();
        }

        function undoMove() {
            if (game.isReverseMode) {
                // é€†æ¨æ¨¡å¼çš„æ’¤é”€
                if (game.reverseHistory.length === 0) {
                    alert('æ²¡æœ‰å¯æ’¤å›çš„é€†æ¨æ­¥éª¤ï¼');
                    return;
                }
                
                const lastReverseMove = game.reverseHistory.pop();
                game.board = [...lastReverseMove.boardState];
                game.reverseStep--;
                game.selectedPiece = -1;
                
                game.updateDisplay();
                game.updateStatus(`å·²æ’¤å›é€†æ¨æ­¥éª¤ã€‚å½“å‰æ£‹å­æ•°é‡ï¼š${game.board.filter(cell => cell).length}`);
                game.updateMoveHint("é€‰æ‹©æ£‹å­æŸ¥çœ‹é€†æ¨é€‰é¡¹");
            } else {
                // æ­£å‘æ¨¡å¼çš„æ’¤é”€
                if (game.moveHistory.length === 0) {
                    alert('æ²¡æœ‰å¯æ’¤å›çš„æ­¥éª¤ï¼');
                    return;
                }
                
                const lastMove = game.moveHistory.pop();
                game.board = [...lastMove.boardState];
                game.moveCount--;
                game.selectedPiece = -1;
                
                game.updateDisplay();
                game.updateStatus(`å·²æ’¤å›ä¸Šä¸€æ­¥ã€‚å½“å‰æ£‹å­æ•°é‡ï¼š${game.board.filter(cell => cell).length}`);
                game.updateMoveHint("é€‰æ‹©ä¸€æšæ£‹å­è¿›è¡Œè·³è·ƒ");
            }
        }

        function toggleMode() {
            game.selectedPiece = -1;
            
            if (game.isReverseMode) {
                if (game.reverseSetup) {
                    // ä»é€†æ¨è®¾ç½®é˜¶æ®µåˆ‡æ¢åˆ°é€†æ¨æ¸¸æˆé˜¶æ®µ
                    const pieceCount = game.board.filter(cell => cell).length;
                    if (pieceCount === 0) {
                        alert('è¯·è‡³å°‘æ”¾ç½®ä¸€æšæ£‹å­ï¼');
                        return;
                    }
                    game.reverseSetup = false;
                    game.updateGamePhase("é€†æ¨æ¨¡å¼ï¼šä»ç»“æœå¾€å›æ¨");
                    game.updateStatus("é€†æ¨æ¨¡å¼ï¼šç‚¹å‡»æ£‹å­æŸ¥çœ‹å¯èƒ½çš„ä¸Šä¸€æ­¥");
                    game.updateMoveHint("é€‰æ‹©æ£‹å­æŸ¥çœ‹é€†æ¨é€‰é¡¹");
                    document.getElementById('modeBtn').textContent = 'ç»“æŸé€†æ¨æ¨¡å¼';
                } else {
                    // åˆ‡æ¢åˆ°æ­£å‘æ¨¡å¼
                    game.isReverseMode = false;
                    game.reverseStep = 0;
                    game.reverseSetup = false;
                    // åˆ‡æ¢å›10ä¸ªæ ¼å­çš„æ£‹ç›˜
                    game.boardSize = 10;
                    game.board = Array(game.boardSize).fill(true);
                    game.gameStarted = false;
                    // é‡æ–°åˆ›å»ºæ£‹ç›˜
                    game.createBoard();
                    document.getElementById('modeBtn').textContent = 'åˆ‡æ¢åˆ°é€†æ¨æ¨¡å¼';
                    game.updateGamePhase("é˜¶æ®µä¸€ï¼šé€‰æ‹©åˆå§‹ç©ºæ ¼ä½ç½®");
                    game.updateStatus("è¯·ç‚¹å‡»ä»»æ„æ£‹å­ç§»é™¤ï¼Œåˆ›å»ºåˆå§‹ç©ºæ ¼å¼€å§‹æ¸¸æˆ");
                    game.updateMoveHint("");
                }
            } else {
                // åˆ‡æ¢åˆ°é€†æ¨æ¨¡å¼
                game.isReverseMode = true;
                game.reverseStep = 0;
                game.reverseSetup = true;
                // åˆ‡æ¢åˆ°20ä¸ªæ ¼å­çš„æ£‹ç›˜
                game.boardSize = 20;
                game.board = Array(game.boardSize).fill(false);
                // é‡æ–°åˆ›å»ºæ£‹ç›˜
                game.createBoard();
                document.getElementById('modeBtn').textContent = 'å¼€å§‹é€†æ¨';
                game.updateGamePhase("é€†æ¨æ¨¡å¼è®¾ç½®ï¼šç‚¹å‡»ç©ºæ ¼æ”¾ç½®æ£‹å­");
                game.updateStatus("é€†æ¨æ¨¡å¼ï¼šè¯·åœ¨20æ ¼æ£‹ç›˜ä¸Šæ”¾ç½®ä¸€ä¸ªæ£‹å­ä½œä¸ºé€†æ¨çš„èµ·ç‚¹");
                game.updateMoveHint("ç‚¹å‡»ç©ºæ ¼æ”¾ç½®æ£‹å­ï¼Œæ”¾ç½®åå°†è‡ªåŠ¨å¼€å§‹é€†æ¨");
                
                // å»¶è¿Ÿæ»šåŠ¨åˆ°ä¸­å¿ƒä½ç½®ï¼Œç¡®ä¿DOMå·²æ›´æ–°
                setTimeout(() => {
                    game.scrollToCenter();
                }, 200);
            }
            
            game.updateDisplay();
        }
    </script>
</body>
</html>
